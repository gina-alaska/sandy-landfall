name: CI

on:
    push:
        branches: [master]

jobs:
    build:
        runs-on: ubuntu-latest
        container:
            image: redhat/ubi8
        steps:
            - name: Checkout Code
              uses: actions/checkout@v4
            - name: install prerecs
              run: |
                 dnf -y update && dnf -y install openssh-clients
            - name: Add SSH key
              env:
                  SSH_AUTH_SOCK: /tmp/ssh_agent.sock
              run: |
                  mkdir -p /home/runner/.ssh
                  echo "${{ secrets.DEPLOY_KEY }}" > /home/runner/.ssh/github_actions
                  chmod 600 /home/runner/.ssh/github_actions
                  ssh-agent -a $SSH_AUTH_SOCK > /dev/null	
                  ssh-add /home/runner/.ssh/github_actions
                  ssh-add -L
                  pwd
            - name: Build and deploy
              env:
                  SSH_AUTH_SOCK: /tmp/ssh_agent.sock
              run: |
                  pwd
                
